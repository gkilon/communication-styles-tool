import { Scores } from '../types';

interface Analysis {
  general: string;
  strengths: string;
  weaknesses: string;
  recommendations: string;
}

// Helper function to classify score levels
const getLevel = (score1: number, score2: number): 'high1' | 'high2' | 'balanced' => {
  const total = score1 + score2;
  const diff = Math.abs(score1 - score2);
  // If the difference is less than 20% of the total, consider it balanced
  if (diff < total * 0.2) return 'balanced';
  return score1 > score2 ? 'high1' : 'high2';
};


export const generateProfileAnalysis = (scores: Scores): Analysis => {
  const { a, b, c, d } = scores;

  const extroversionLevel = getLevel(a, b); // a: extro, b: intro
  const orientationLevel = getLevel(c, d); // c: task, d: people

  let general = '';
  let strengths = '';
  let weaknesses = '';
  let recommendations = '';

  // 1. General Description
  const extroversionDesc = {
    high1: 'הנטייה הדומיננטית שלך היא מוחצנות (הציר האדום-צהוב). אתה אנרגטי, אקספרסיבי ונוטה לפעול במהירות. אתה שואב אנרגיה מאינטראקציה עם אחרים.',
    high2: 'הנטייה הדומיננטית שלך היא מופנמות (הציר הכחול-ירוק). אתה נוטה להיות שקול, מאופק ומהורהר. אתה מעדיף לחשוב לפני שאתה פועל ומעבד מידע באופן פנימי.',
    balanced: 'יש לך איזון בין מוחצנות למופנמות, מה שמאפשר לך גמישות רבה. אתה יכול להיות יוזם וחברותי כשצריך, אך גם יודע להקשיב, להתבונן מהצד ולפעול באופן שקול.'
  };

  const orientationDesc = {
    high1: 'אתה מונחה משימה באופן מובהק (הציר האדום-כחול). חשובים לך היעילות, התוצאות וההיגיון. אתה מתמקד ב"מה" צריך לעשות ופחות ב"איך" אנשים מרגישים לגבי זה.',
    high2: 'אתה מונחה אנשים באופן מובהק (הציר הצהוב-ירוק). הרמוניה, שיתוף פעולה ויחסים טובים עומדים בראש סדר העדיפויות שלך. אתה רגיש לרגשות של אחרים ופועל ליצירת סביבה תומכת.',
    balanced: 'אתה מצליח לאזן בין הצרכים של המשימה לבין הצרכים של האנשים. אתה מבין שתוצאות טובות מושגות דרך שילוב של יעילות עם שיתוף פעולה והתחשבות הדדית.'
  };

  general = `${extroversionDesc[extroversionLevel]} ${orientationDesc[orientationLevel]} השילוב הייחודי בין שני הצירים הללו מעצב את סגנון התקשורת המרכזי שלך ומעניק לך סט כלים ייחודי להתמודדות עם מצבים שונים.`;

  // 2. Strengths, Weaknesses, Recommendations based on quadrants
  if (extroversionLevel === 'high1' && orientationLevel === 'high1') { // RED
    strengths = 'השילוב של מוחצנות ומשימתיות מקנה לך יכולת מנהיגות טבעית והחלטית. אתה חדור מטרה, לא חושש מאתגרים, יודע לקבל החלטות מהירות תחת לחץ ומצטיין בהנעת תהליכים ותוצאות. הישירות שלך תורמת לתקשורת ברורה ויעילה.';
    weaknesses = 'המיקוד החזק במטרה עלול לעיתים להוביל לחוסר סבלנות כלפי תהליכים איטיים או דעות שונות. השילוב הזה עלול לגרום לך להיתפס כשתלטן, אגרסיבי, או כמי שאינו רגיש מספיק לרגשות ולצרכים של הסובבים אותו, בעיקר אלו עם סגנון ירוק או צהוב.';
    recommendations = 'כדי למקסם את ההשפעה שלך, נסה לאזן את ההובלה הטבעית שלך עם הקשבה פעילה ומודעת. לפני קבלת החלטה, הקדש רגע לשמוע נקודות מבט נוספות, במיוחד מאנשי הצוות השקטים יותר. תרגול אמפתיה והכרה בתרומתם של אחרים יהפוך אותך למנהיג מעורר השראה ומכיל עוד יותר.';
  } else if (extroversionLevel === 'high1' && orientationLevel === 'high2') { // YELLOW
    strengths = 'השילוב של מוחצנות ואנושיות יוצר אישיות כריזמטית, אופטימית ומשפיעה. אתה מצטיין ביצירת קשרים, בהשראה ובהנעת אנשים דרך התלהבות וחזון. האנרגיה החיובית שלך בונה מורל ומעודדת יצירתיות ושיתוף פעולה.';
    weaknesses = 'ההתמקדות בתמונה הגדולה וביחסים עלולה לגרום לך להזניח פרטים חשובים, תכנון וסדר. ייתכן שאתה נוטה להימנע מעימותים ומתקשה למסור משוב שלילי כדי לשמור על אווירה טובה, מה שעלול לפגוע ביעילות בטווח הארוך.';
    recommendations = 'כדי להפוך את הרעיונות הגדולים שלך למציאות, חבור לאנשים בעלי סגנון כחול או אדום שיכולים לעזור לך בבניית תוכנית עבודה מסודרת ובמעקב אחר פרטים. למד לאזן בין האופטימיות הטבעית שלך לבין הערכה מציאותית של אתגרים, ואל תחשוש משיחות קשות – הן חיוניות לצמיחה אישית וצוותית.';
  } else if (extroversionLevel === 'high2' && orientationLevel === 'high2') { // GREEN
    strengths = 'השילוב של מופנמות ואנושיות הופך אותך לעוגן של יציבות, תמיכה והרמוניה. יכולת ההקשבה יוצאת הדופן שלך, הסבלנות והאמפתיה הופכות אותך לאיש צוות אידיאלי, איש סוד וגורם מרכזי בגישור ופתרון קונפליקטים. אנשים סומכים עליך ומרגישים בטוחים בסביבתך.';
    weaknesses = 'השאיפה העזה להרמוניה עלולה להוביל להימנעות מוחלטת מעימותים והתנגדות לשינויים שעלולים לערער את היציבות. לעיתים, ייתכן שתתקשה להביע את דעתך בנחרצות או לקבל החלטות במהירות, במיוחד כשהן עלולות לפגוע ברגשותיו של מישהו.';
    recommendations = 'הקול השקול והחשוב שלך חייב להישמע. תרגל הבעת דעות ועמדות באופן אסרטיבי אך מכבד, גם אם הן שונות משל אחרים. התחל בסיטואציות בסיכון נמוך. זכור ששינוי הוא הזדמנות, והיציבות שלך יכולה דווקא לעזור לאחרים לנווט בו בבטחה.';
  } else if (extroversionLevel === 'high2' && orientationLevel === 'high1') { // BLUE
    strengths = 'השילוב של מופנמות ומשימתיות יוצר חשיבה אנליטית, יסודית ומדויקת. אתה שואף לאיכות גבוהה, מקפיד על עובדות ונתונים ומצטיין בתכנון, ארגון ובקרת איכות. הגישה המחושבת והזהירה שלך מבטיחה עבודה מקצועית ונטולת טעויות.';
    weaknesses = 'השאיפה לשלמות עלולה להוביל לביקורתיות יתר (כלפי עצמך וכלפי אחרים), ולקושי בקבלת החלטות ללא כל המידע הנדרש ("analysis paralysis"). הריחוק הרגשי וההתמקדות בעובדות עלולים לגרום לך להיתפס כקר, מרוחק או כמי שמתעכב יתר על המידה על פרטים קטנים.';
    recommendations = 'למד לסמוך על האינטואיציה שלך לצד הנתונים, והכיר בכך שלעיתים החלטה "טובה מספיק" שהתקבלה בזמן עדיפה על החלטה "מושלמת" שהגיעה מאוחר מדי. נסה לראות את התמונה הגדולה ולהתמקד בעיקר. שיתוף הרציונל מאחורי החלטותיך יסייע לסגנונות ה"חמים" יותר (צהוב וירוק) להבין את נקודת מבטך ולהתחבר אליה.';
  } else { // Balanced profiles
    strengths = 'החוזקה המרכזית שלך היא הגמישות והיכולת להתאים את סגנון התקשורת שלך למצב ולאדם שמולך. אתה יכול להיות משימתי כשצריך, אך גם רגיש לאנשים; להיות יוזם ומוביל, אך גם מקשיב ותומך. יכולת זו הופכת אותך למגשר, מנהל ואיש צוות וורסטילי ומוערך במיוחד.';
    weaknesses = 'האתגר שלך טמון בכך שלעיתים אתה עלול להיתפס כלא עקבי או כמי שקשה "לקרוא" אותו, מכיוון שסגנונך משתנה. ייתכן שאתה מתקשה לזהות את הנטייה הטבעית הדומיננטית שלך, מה שמקשה על מינוף החוזקות המולדות שלך באופן עקבי, או שאתה משקיע אנרגיה רבה מדי בהתאמה לסביבה.';
    recommendations = 'הגבר את המודעות העצמית שלך: נסה לזהות באילו מצבים אתה נוטה להשתמש בכל סגנון ומדוע. השתמש בגמישות שלך באופן מודע ומכוון - בחר את הגישה המתאימה ביותר לכל סיטואציה במקום לפעול באופן אוטומטי. שקיפות לגבי כוונותיך ("בפגישה הזו אני רוצה שנתמקד בנתונים", "עכשיו חשוב לי לשמוע איך כולם מרגישים") תסייע לאחרים להבין את פעולותיך.';
  }


  return { general, strengths, weaknesses, recommendations };
};